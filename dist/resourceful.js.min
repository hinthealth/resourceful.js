/*! Resourceful.js 31-01-2014 */
!function(){"function"!=typeof Object.create&&(Object.create=function(a){function b(){}return b.prototype=a,new b});var a=angular.extend,b=angular.module("resourceful",[]);b.provider("resourceful",function(){function b(a){this.configure(a)}function c(a){this.setResource(a)}function d(a){this.prototype=c,this.parent=a,this._newRecord=!0}b.prototype.configure=function(b){return a(this,b),this},b.prototype.endpoint=function(a){return new f(this,a)},b.prototype.url=function(){return this.prefix},b.prototype.resource=function(a){return new e(this,a)},b.prototype.singleton=function(a){return new e(this,a)},this.base=new b({identifyBy:"id",prefix:""});var e=function(a,b){this.endpoint=new f(a,b),this.recordClass=new c(this),this.identifyBy=a.identifyBy,this.associations={}};e.prototype.resource=function(a){this.associations[a]=new e(this,a)},e.prototype.record=function(){var a=Object.create(this.recordClass);return a.associations(this.associations),Object.create(a)},e.prototype.build=function(a){var b=this.record();return b.setAttributes(a),b},e.prototype.create=function(a){var b=this.build(a);return b.save(),b},e.prototype.find=function(a){var b=this.record();return b.setIdentifier(a),b.load(),b},e.prototype.arrayfromResponse=function(a){return a.data},e.prototype.all=function(){var a=[],b=this;return a.promise=this.endpoint.get(),a.promise.then(function(c){var d,e,f,g;f=b.arrayfromResponse(c);for(d in f)g=f[d],e=b.record(),e.setAttributes(g),e.setIdentifier(e.toParam()),a.push(e)}),a},c.prototype.associations=function(b){this.associations=b,a(this,this.associations)},c.prototype.endpoint=function(a){return"record"==a?this.resource.endpoint.endpoint(this.toParam()):this.resource.endpoint},c.prototype.setResource=function(a){return this.resource=a,this},c.prototype.errors=function(a){return void 0===this._errors&&(this._errors={}),a?this._errors[a]||!1:this._errors.length>0?this._errors:!1},c.prototype.identifyBy=function(){return this.resource.identifyBy},c.prototype.setIdentifier=function(a){var b;this[this.identifyBy()]=a,this._newRecord=!1;for(b in this.associations)this[b].endpoint.setParent(this.endpoint("record"))},c.prototype.reload=function(){this.load()},c.prototype.isNewRecord=function(){return void 0===this._newRecord&&(this._newRecord=!0),this._newRecord},c.prototype.toParam=function(){return this[this.identifyBy()]},c.prototype.setAttributes=function(a){var b;for(b in a)this[b]=a[b];return a},c.prototype.attributes=function(){var a,b={};for(a in this)"_"!=a[0]&&this.hasOwnProperty(a)&&(b[a]=this[a]);return b},c.prototype.attributesfromResponse=function(a){return a.data},c.prototype.capture=function(a,b){var c=this;b.then(function(b){"delete"!==a&&c.setAttributes(c.attributesfromResponse(b)),"create"==a&&c.setIdentifier(c.toParam())},function(a){c._errors=a.data.errors})},c.prototype.load=function(){var a=this.endpoint("record").get();return this.capture("load",a),a},c.prototype.save=function(){var a;return this.isNewRecord()?(a=this.endpoint().post(this.attributes()),this.capture("create",a)):(a=this.endpoint("record").patch(this.attributes()),this.capture("update",a)),a},d.prototype.endpoint=function(){return this.parent};var f=function(a,b){b&&(this.path=b),this.setParent(a)};f.prototype.setParent=function(a){this.parent=a},f.prototype.endpoint=function(a){return new f(this,a)},f.prototype.one=function(a){return this.child(a)},f.prototype.url=function(){return this._url?this._url:this.parent?this.parent.url()+"/"+this.path:this.path?this.path:"/"},f.prototype.defaults={},f.prototype.httpRequest=function(a,b,c,d){if(!this.http)throw"http not defined yet!";var e={url:this.url(),method:a,data:b,params:c,headers:d};return this.http(e)},f.prototype.post=function(a){return this.httpRequest("POST",a)},f.prototype.get=function(a){return this.httpRequest("GET",null,a)},f.prototype.patch=function(a){return this.httpRequest("PATCH",a,null)},f.prototype.put=function(a){return this.httpRequest("PUT",a,null)},f.prototype.delete=function(){return this.httpRequest("DELETE")},this.endpoint=f.endpoint,this.configure=this.base.configure,this.$get=["$http","$q",function(a){return f.prototype.http=a,this.base}]})}();